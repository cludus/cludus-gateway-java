version: "3.9"

services:
  proxy:
    hostname: gateway.cludus.tests
    volumes:
      - ./haproxy.cfg:/usr/local/etc/haproxy/haproxy.cfg
    depends_on:
      - gateway-1
      - gateway-2
      - gateway-3
      - prometheus
    image: haproxy:2.8
    networks:
      default:
        aliases:
          - metrics.cludus.tests

  gateway-1:
    image: ghcr.io/cludus/gateway-java:0.0.2

  gateway-2:
    image: ghcr.io/cludus/gateway-java:0.0.2

  gateway-3:
    image: ghcr.io/cludus/gateway-java:0.0.2

  prometheus:
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
    image: prom/prometheus:latest