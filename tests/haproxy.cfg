defaults
  mode    http
  log     global
  log     stdout format raw local0
  timeout client          25s
  timeout connect         20s
  timeout server          25s
  timeout tunnel        3600s
  timeout http-keep-alive 10s
  timeout http-request    15s
  timeout queue           30s
  timeout tarpit          60s

frontend cludus_frontend
   bind *:80
   maxconn 100000
   acl is_metrics_host hdr_beg(host) -i metrics.cludus.tests
   use_backend cludus_metrics_backend if is_metrics_host
   acl is_gateway_host hdr_beg(host) -i gateway.cludus.tests
   use_backend cludus_gateway_backend if is_gateway_host

 frontend prometheus_stats
   bind *:8404
   http-request use-service prometheus-exporter if { path /prometheus/metrics }
   stats enable
   stats uri /stats
   stats refresh 10s

 backend cludus_gateway_backend
  balance roundrobin
  server gateway1 gateway-1:8080 maxconn 10000 weight 10 check
  server gateway2 gateway-2:8080 maxconn 10000 weight 10 check
  server gateway3 gateway-3:8080 maxconn 10000 weight 10 check

backend cludus_metrics_backend
  balance roundrobin
  server prometheus prometheus:9090 maxconn 10000 check
